# 우선순위가 높은 명세 권장 사항

Spec-Kit 방법론과 초기 프로젝트 구조(Next.js 16 + Tailwind CSS 4) 분석을 바탕으로, 견고하고 확장 가능한 "ProbeAI" 애플리케이션을 위해 상세 명세가 필요한 5가지 영역을 도출했습니다.

## 1. 글로벌 테마 및 UI 컴포넌트 아키텍처
**Why (이유):**
ProbeAI는 에이전트의 '사고 과정'과 '최종 결과물'을 명확히 구분하여 보여줘야 합니다. Tailwind CSS 4의 최신 기능을 활용해 Deep Navy와 Electric Blue 기반의 전문적인 연구 도구 느낌을 구현하고, 에이전트의 상태(Thinking, Searching, Complete)를 시각적으로 즉각 인지할 수 있는 일관된 컴포넌트 시스템이 필요합니다.

**What to Specify (명세할 내용):**
-   **디자인 토큰:** Tailwind v4 CSS 변수를 활용한 브랜드 컬러(--color-probe-primary, --color-probe-accent), 에이전트 상태별 의미론적 색상(Searching: Blue, Analyzing: Purple, Error: Red).
-   **컴포넌트 라이브러리:** 리서치 입력창(SearchConsole), 실시간 상태 스트리밍 바, 마크다운 리포트 컨테이너, 인라인 인용구(Citation) 팝오버.
-   **다크 모드 전략:** next-themes를 이용한 다크 모드 우선 설계. 에이전트 보고서의 가독성을 위해 고대비 텍스트 스케일 적용.

## 2. 드래그 앤 드롭(D&D) 인터랙션 모델
**Why (이유):**
ProbeAI에서 가장 중요한 인터랙션은 에이전트와 사용자 간의 '피드백 루프'입니다. 특히 Plan Confirmation Mode에서 사용자가 에이전트의 계획을 수정하거나 순서를 변경하는 드래그 앤 드롭(D&D) 조작은 직관적인 리서치 경험을 결정짓는 핵심 요소입니다.

**What to Specify (명세할 내용):**
-   **라이브러리 선정:** 복잡한 리스트 정렬 및 접근성을 지원하는 @dnd-kit 선정.
-   **인터랙션 규칙:** 리서치 하위 태스크(Sub-tasks)의 우선순위 재배치, 특정 태스크 삭제/추가 제스처, 에이전트 가동 중 실시간 프로그레스 바 애니메이션.
-   **상태 업데이트:** 태스크 순서 변경 시 LangGraph의 상태(State)와 즉각 동기화되는 낙관적 업데이트 로직.

## 3. 데이터 내보내기 및 리포팅 엔진
**Why (이유):**
ProbeAI의 최종 가치는 '결과물'에 있습니다. 에이전트가 생성한 마크다운 리포트, Mermaid.js 차트, 수집된 레퍼런스를 사용자가 즉시 업무에 활용할 수 있도록 고품질의 포맷팅과 내보내기 기능이 구현되어야 합니다.

**What to Specify (명세할 내용):**
-   **지원 형식:** 전문적인 레이아웃이 반영된 PDF(출처 포함), Notion 복사용 Markdown, 데이터 분석용 JSON.
-   **처리 전략:** Mermaid.js 기반의 다이어그램 렌더링 및 Recharts를 활용한 수치 데이터 시각화 컴포넌트 명세.
-   **API 설계:** 리포트 양이 방대할 경우를 대비하여 서버 사이드 PDF 생성 로직 및 클라이언트 측 스트리밍 렌더링 분리.

## 4. 글로벌 상태 관리 전략
**Why (이유):**
ProbeAI는 실시간으로 변화하는 에이전트의 내부 상태(현재 검색 중인 쿼리, 수집된 문서 수, 작성 중인 문구)를 관리해야 합니다. 복잡한 에이전트의 그래프 상태와 일반 UI 상태를 효율적으로 분리하여 성능 저하를 방지해야 합니다.

**What to Specify (명세할 내용):**
-   **상태 분리:** 서버 상태(Tavily 검색 결과, Gemini 응답)는 TanStack Query로 관리, 에이전트의 실시간 단계 및 UI 토글 상태는 Zustand로 관리.
-   **스트리밍 상태 동기화:** Server-Sent Events(SSE)로 넘어오는 에이전트의 '생각' 조각들을 클라이언트 스토어에 순차적으로 병합하는 로직.
-   **지속성(Persistence):** 최근 수행한 리서치 기록 및 사용자 설정(Confirmation On/Off)을 localStorage에 유지.

## 5. API 통합 및 에러 처리 표준
**Why (이유):**
LLM 호출과 웹 스크래핑은 본질적으로 불안정합니다. ProbeAI는 에이전트 작업 중 발생할 수 있는 타임아웃, 할당량 초과, 스크래핑 차단 등의 에러를 사용자에게 불쾌하지 않게 전달하고 우아하게 복구해야 합니다.

**What to Specify (명세할 내용):**
-   **Fetch 클라이언트:** Gemini API 및 Tavily API 호출 시 10초 타임아웃 및 지수 백오프(Exponential Backoff) 재시도 로직 적용.
-   **에러 표준화:** Zod를 이용한 API 응답 스키마 검증. 에이전트 중단 시 현재까지 수집된 데이터를 보존하고 "이어서 시도"할 수 있는 체크포인트 UI 전략.
-   **UI 폴백:** 특정 차트 렌더링 실패 시 원본 테이블 데이터를 보여주는 폴백 컴포넌트 명세.